import json
import os
from typing import Dict

class Storage:
    def __init__(self, file_path: str):
        self.file_path = file_path

    def load_history(self) -> Dict:
        if not os.path.exists(self.file_path):
            return {
                "scanner": "Tenable.io",
                "environment": "Enterprise Windows / Infrastructure",
                "scan_history": {}
            }
        try:
            with open(self.file_path, 'r') as f:
                return json.load(f)
        except json.JSONDecodeError:
             return {
                "scanner": "Tenable.io",
                "environment": "Enterprise Windows / Infrastructure",
                "scan_history": {}
            }

    def update_cumulative_json(self, scan_date: str, summary_data: Dict):
        history = self.load_history()
        
        # Ensure base structure exists
        if "scan_history" not in history:
            history["scan_history"] = {}
            
        # Append/Update date entry
        # The prompt says "Each scan run appends a NEW date entry".
        # If date exists, we'll overwrite it for idempotency in this POC, 
        # but in a real streaming log we might error or append time.
        # Assuming one summary per day for this structure.
        history["scan_history"][scan_date] = summary_data
        
        with open(self.file_path, 'w') as f:
            json.dump(history, f, indent=2)
